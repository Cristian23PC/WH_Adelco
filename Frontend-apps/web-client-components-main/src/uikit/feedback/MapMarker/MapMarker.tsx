import React from 'react';
import { Marker } from '@react-google-maps/api';
import { type MapMarker as MapMarkerProp } from '../../../utils/types/Map.type';

const MapMarker: React.FC<MapMarkerProp> = ({
  position,
  customIcon = true,
  color = '#FCE300',
  className,
  draggable = false,
  onDragEnd,
  onClick
}) => {
  const template = [
    '<svg data-testid="marker-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">',
    '<rect width="24" height="24" rx="12" fill="{{ color }}"/>',
    '<path d="M18.3325 9.52823L17.6183 6.6149C17.4686 6.0149 16.9381 5.60156 16.3191 5.60156H6.87082C6.25863 5.60156 5.72125 6.02156 5.57841 6.6149L4.86418 9.52823C4.70093 10.2082 4.85057 10.9016 5.28591 11.4482C5.34033 11.5216 5.41515 11.5749 5.47637 11.6416V16.2682C5.47637 17.0016 6.08857 17.6016 6.83681 17.6016H16.3599C17.1081 17.6016 17.7203 17.0016 17.7203 16.2682V11.6416C17.7815 11.5816 17.8564 11.5216 17.9108 11.4549C18.3461 10.9082 18.5026 10.2082 18.3325 9.52823ZM16.2987 6.92823L17.0129 9.84156C17.0809 10.1216 17.0197 10.4016 16.8428 10.6216C16.7476 10.7416 16.5435 10.9349 16.2034 10.9349C15.7885 10.9349 15.428 10.6082 15.3804 10.1749L14.9858 6.9349L16.2987 6.92823ZM12.2786 6.9349H13.6118L13.9791 9.94823C14.0131 10.2082 13.9315 10.4682 13.7546 10.6616C13.605 10.8349 13.3873 10.9349 13.1084 10.9349C12.6527 10.9349 12.2786 10.5416 12.2786 10.0616V6.9349ZM9.21078 9.94823L9.5849 6.9349H10.9181V10.0616C10.9181 10.5416 10.544 10.9349 10.0406 10.9349C9.80937 10.9349 9.5985 10.8349 9.43525 10.6616C9.26519 10.4682 9.18357 10.2082 9.21078 9.94823ZM6.1838 9.84156L6.87082 6.9349H8.21085L7.81633 10.1749C7.76191 10.6082 7.4082 10.9349 6.99326 10.9349C6.65996 10.9349 6.44909 10.7416 6.36066 10.6216C6.177 10.4082 6.11578 10.1216 6.1838 9.84156ZM6.83681 16.2682V12.2482C6.89123 12.2549 6.93884 12.2682 6.99326 12.2682C7.58505 12.2682 8.12243 12.0282 8.51695 11.6349C8.92508 12.0349 9.46926 12.2682 10.0883 12.2682C10.68 12.2682 11.2106 12.0282 11.6051 11.6482C12.0065 12.0282 12.5507 12.2682 13.1628 12.2682C13.7342 12.2682 14.2784 12.0349 14.6865 11.6349C15.0811 12.0282 15.6184 12.2682 16.2102 12.2682C16.2646 12.2682 16.3123 12.2549 16.3667 12.2482V16.2682H6.83681Z" fill="#1D1D1B"/>',
    '</svg>'
  ].join('\n');

  const icon = {
    url:
      'data:image/svg+xml;charset=UTF-8,' +
      encodeURIComponent(template.replace('{{ color }}', color))
  };

  return (
    <Marker
      icon={customIcon ? icon : undefined}
      draggable={draggable}
      onDragEnd={onDragEnd}
      position={{
        lat: position.lat,
        lng: position.long
      }}
      onClick={onClick}
    />
  );
};

export default MapMarker;
